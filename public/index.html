<!DOCTYPE html>
<html>
<head>
  <title>Drum Machine</title>
  <link rel="stylesheet" href="styles/style.css"/>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
  <script type="application/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script type="application/javascript" src="scripts/index.js"></script>
  <script type="application/javascript" src="scripts/interval.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.2/howler.core.min.js"></script>
  <script src="../timesync/timesync.js"></script> 
</head>
<script>
    // create a timesync client
    var ts = timesync.create({
        server: '/timesync',
        interval: 10000
    });
</script>
<body onload="Init()">
	<div id="app">
		<div id="center_column">
			<div id="audio_bay"></div>
				<table class="drum_table">
					<tbody v-for="(drum_row, row_index) in all_rows">
						<tr>
							<td @click="SendRemoveDrumMessage(drum_row.inst, drum_row.file_path, row_index)" :class="{'inst': row_index!= 0, 'all_inst': true}">
								<span v-if="add_drum_drop == true" >
									<i class="remove fas fa-minus-circle"></i>
								</span>
								{{drum_row.inst}}
							</td>
							<td v-for="(node, node_index) in drum_row.nodes" 
							    @click="ClickNode(row_index, node_index)"
							    :class="{ 'pads': true, 'pads-selected': node.selected == true, 'pads-play': node.play == true, 'curr_note':
							               node.curr_note==true, 'down_beats': node_index%4==0}">
							</td>
						</tr>
						<tr v-if="row_index == all_rows.length-1">
							<td>
								<div>
									<button class="buttons" @click="add_drum_drop = !add_drum_drop" v-if="add_drum_drop == true">-</button>
									<button class="buttons" @click="add_drum_drop = !add_drum_drop" v-else>+</button>
									<div v-if="add_drum_drop == true" v-for="(drum, drum_index) in avail_drums">
										<table>
											<tr>
												<td :class="{'inst': drum_index!= 0, 'all_inst': true}" @click="SendCreateDrumMessage(drum.name, drum.file_path, drum_index); console.log('yup')"><i class="add fas fa-plus-circle"></i> {{drum.name}}</td>
											</tr>
										</table>
									</div>
								</div>
							</td>
						</tr>
					</tbody>
				</table>
				<center>
					<div class="controls">
						<span class="control_items">
							Room: <input type="text" min="0" max="9999" v-model="room_id" size="4" id="room_id">
							<button @click="JoinRoom()" class="buttons">Join</button>
						</span>
						<span class="control_items">
							BPM: {{bpm}} <input type="range" min="1" max="200" v-model="bpm" class="slider" id="myRange">
						</span>
						<span class="control_items">
							<button @click="SendStopMessage()" v-if="playing==true" class="buttons">
								<i class="fas fa-stop"></i>
							</button>
							<button @click="SendPlayMessage()" v-if="playing==false" class="buttons">
								<i class="fas fa-play"></i>
							</button>
						</span>
						<span>
							<button @click="Clear()" class="buttons">Clear</button>
						</span>
					</div>
				</center>
			</div>
		</div>
	</div>
</body>
</html>
