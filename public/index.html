<!DOCTYPE html>
<html>
<head>
  <title>Beat Collab</title>
  <link rel="stylesheet" href="styles/style.css"/>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
  <!--<script type="application/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>-->
  <script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script type="application/javascript" src="scripts/interval.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.2/howler.core.min.js"></script>
  <script src="../timesync/timesync.js"></script> 
  <script type="text/x-template" id="modal-template">
      <transition name="modal">
        <div class="modal-mask">
          <div class="modal-wrapper">
            <div class="modal-container">
              <div class="modal-header">
                <slot name="header">
                  default header
                </slot>
              </div>
              <div class="modal-footer">
                <slot name="footer">
                </slot>
              </div>
            </div>
          </div>
        </div>
      </transition>
    </script>
    <script type="application/javascript" src="scripts/index.js"></script>
</head>
<body onload="Init()">
	<div id="app">
		<div class="nav">
			<span>
				<center>
					<h1>Beat-Collab</h1>
				</center>
			</span>
		</div>
		<center>
			<div id="center_column">
	      		<modal v-if="show_modal">
	       			<h3 slot="header">Welcome</h3>
	        		<span slot="footer" class="control_items">
	        			<table>
	        				<tr>
	        					Nickname:
	        					<input id="username" type="text" v-on:keyup.enter="SubmitUsername()" v-model="username" size="12" id="username">
	        				</tr>
							<tr>
								<td>
									Color:
								</td>
								<td v-for="user_color in user_colors" class="pads user_colors" v-bind:style="{backgroundColor: user_color}" @click="SelectColor(user_color)"
								:class="{'selected_user_color': user_color == selected_user_color}">
								</td>
							</tr>
						</table>
						<button class="buttons" @click=SubmitUsername()>Get Started</button>
					</span>
	      		</modal>
				<span class="dash_items">
					<table class="drum_table">
						<tbody v-for="(drum_row, row_index) in all_rows">
							<tr>
								<td @click="SendRemoveDrumMessage(drum_row.inst, drum_row.file_path, row_index)" :class="{'inst': row_index!= 0, 'all_inst': true}">
									<span v-if="add_drum_drop == true" >
										<i class="remove fas fa-minus-circle"></i>
									</span>
									{{drum_row.inst}}
								</td>
								<td v-for="(node, node_index) in drum_row.nodes" 
									v-bind:style="{backgroundColor: node.color, borderColor: node.color}"
								    @click="ClickNode(row_index, node_index)"
								    :class="{ 'pads': true, 'pads-selected': node.selected == true, 'curr_note': node.curr_note==true, 'down_beats': node_index%4==0}">
								    	<center><span class="noselect">{{node.selected}}</span></center>
								</td>
							</tr>
							<tr v-if="row_index == all_rows.length-1 && avail_drums.length > 0">
								<td>
									<div>
										<button class="buttons" @click="add_drum_drop = !add_drum_drop" v-if="add_drum_drop == true">-</button>
										<button class="buttons" @click="add_drum_drop = !add_drum_drop" v-else>+</button>
										<div v-if="add_drum_drop == true" v-for="(drum, drum_index) in avail_drums">
											<table>
												<tr>
													<td :class="{'inst': drum_index!= 0, 'all_inst': true}" @click="SendCreateDrumMessage(drum.name, drum.file_path, drum_index); console.log('yup')"><i class="add fas fa-plus-circle"></i> {{drum.name}}</td>
												</tr>
											</table>
										</div>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
					<center>
						<div class="controls">
							<span class="control_items">
								<button v-on:keyup.space="SendStopMessage()" @click="SendStopMessage()" v-if="playing==true" class="buttons">
									<i class="fas fa-stop"></i>
								</button>
								<button v-on:keyup.space="SendPlayMessage()" @click="SendPlayMessage()" v-if="playing==false" class="buttons">
									<i class="fas fa-play"></i>
								</button>
								
							</span>
							<span class="control_items">
								BPM<input type="range" min="1" max="200" v-model="bpm" class="slider">{{bpm}}
							</span>
							<span class="control_items">
								Volume<input type="range" min="0" max="100" v-model="volume" class="slider">{{volume}}
							</span>
							<span class="control_items">
								<button @click="Clear()" class="buttons">Clear</button>
							</span>
							
						</div>
					</center>
				</span>
				<span class="dash_items">
					<span class="control_items">
						Room: <input type="text" min="0" max="9999" v-on:keyup.enter="JoinRoom()" v-model="room_id" size="5" id="room_id">
						<button @click="JoinRoom()" class="buttons" id="join_room_button">Join</button>
					</span>
					<div class="chat">
						<div class="messages" >
							<div v-for="message in messages" class="message"
								:class="{message_from_me: message.sender == username, 
										 message_not_from_me: message.sender != username}"
										 v-bind:style="{borderColor: message.color}">
								<div class="message_content">{{message.message_content}}</div>
								<div v-if="message.sender != username" class="sender">{{message.sender}}</div>
							</div>
						</div>
						<span>	
							<input type="text" v-model="new_message" v-on:keyup.enter="SendMessage()" id="new_message">
							<button @click="SendMessage()" class="buttons input_buttons" sytle="float:right"><i class="fas fa-play"></i></button>
						</span>
					</div>
				</span>
			</div>
		</center>
	</div>
</body>
</html>
